name: Dog_Copenhagen_Economic_Data
description: Sales analytics for Dog Copenhagen combining e-conomic ERP data with PrestaShop product catalog. Tracks revenue, profit, inventory, and customer behavior across B2B and B2C channels. Data refreshes every Sunday at 12:00 PM with the latest e-conomic transactions.

tables:
  - name: VW_SALES_DETAIL
    description: Primary sales fact table with invoice line-level detail. Enriched with PrestaShop product data (categories, sizes, colors). All amounts in DKK base currency. Each row is one line item - a single invoice can have multiple lines.
    base_table:
      database: ECONOMIC
      schema: SILVER
      table: VW_SALES_DETAIL

    dimensions:
      # === PRODUCT DIMENSIONS ===
      - name: CATEGORY
        synonyms: [product category, category name, product type, product line, department, product group]
        description: PrestaShop product category. Primary field for category analysis.
        expr: CATEGORY
        data_type: VARCHAR
        sample_values:
          - Harnesses
          - Leads
          - Collars
          - Bowls
          - Bags

      - name: COLOR
        synonyms: [product color, color variant, colour, color option, product colour]
        description: Product color variant from PrestaShop.
        expr: COLOR
        data_type: VARCHAR
        sample_values:
          - Black
          - Mocca
          - Ocean Blue
          - Orange Sun
          - Purple Passion

      - name: SIZE
        synonyms: [product size, size variant, size option, dog size, product sizing]
        description: Product size from PrestaShop.
        expr: SIZE
        data_type: VARCHAR
        sample_values:
          - XS
          - S
          - M
          - L
          - XL
          - One-Size

      - name: PRODUCT_SKU
        synonyms: [sku, product code, item number, article number, product id]
        description: Unique product identifier. Use to analyze specific products or count distinct SKUs.
        expr: PRODUCT_SKU
        data_type: VARCHAR
        sample_values:
          - HAR0569
          - LEA0335
          - COL0311
          - BOW1245

      - name: PRODUCT_NAME
        synonyms: [item name, product description, product title, item description, product]
        description: Full product name.
        expr: PRODUCT_NAME
        data_type: VARCHAR
        sample_values:
          - Comfort Walk Air™ Harness
          - Urban Trail™ Leash
          - Urban Explorer™ Collar
          - Travel Bowl

      - name: EAN13
        synonyms: [barcode, ean, product barcode, ean code, gtin]
        description: EAN13 barcode from PrestaShop for product identification and inventory tracking.
        expr: EAN13
        data_type: VARCHAR
        sample_values:
          - '5710534200001'
          - '5710534200018'
          - '5710534200025'

      - name: PRESTASHOP_MATCH_STATUS
        synonyms: [match status, data quality, enrichment status, product match, prestashop enrichment]
        description: Indicates if SKU matched PrestaShop catalog. 'Matched' = full enrichment (85%+ recent data), 'Adjustment Item' = discounts/freight, 'Not in PrestaShop' = older SKUs.
        expr: PRESTASHOP_MATCH_STATUS
        data_type: VARCHAR
        sample_values:
          - Matched
          - Adjustment Item
          - Not in PrestaShop

      # === CUSTOMER DIMENSIONS ===
      - name: CUSTOMER_ID
        synonyms: [customer number, client id, account id, cust id, customer code]
        description: Unique customer identifier. Use to analyze by customer or count distinct customers.
        expr: CUSTOMER_ID
        data_type: NUMBER
        sample_values:
          - '1001'
          - '2045'
          - '3089'

      - name: CUSTOMER_NAME
        synonyms: [customer, client name, account name, buyer, client, company name]
        description: Name of the customer who made the purchase.
        expr: CUSTOMER_NAME
        data_type: VARCHAR
        sample_values:
          - Pet Shop Denmark
          - Dog Boutique Paris
          - Hundebutikk Norge

      - name: CUSTOMER_SEGMENT
        synonyms: [customer type, segment, channel, business type, sales channel]
        description: Customer segment - B2B (business/wholesale/retail) or B2C (direct consumer sales).
        expr: CUSTOMER_SEGMENT
        data_type: VARCHAR
        sample_values:
          - B2B
          - B2C

      - name: CUSTOMER_COUNTRY
        synonyms: [billing country, customer nation, account country, registered country]
        description: Country where customer is registered. Use DELIVERY_COUNTRY for geographic sales analysis.
        expr: CUSTOMER_COUNTRY
        data_type: VARCHAR
        sample_values:
          - Denmark
          - France
          - Germany
          - Sweden
          - Norway

      - name: CUSTOMER_CITY
        synonyms: [customer location, city, town, customer town]
        description: City where customer is located.
        expr: CUSTOMER_CITY
        data_type: VARCHAR
        sample_values:
          - Copenhagen
          - Paris
          - Amsterdam
          - Berlin

      # === GEOGRAPHY DIMENSIONS ===
      - name: DELIVERY_COUNTRY
        synonyms: [country, shipping country, destination country, sales country, ship to country]
        description: Country where products were delivered. PRIMARY field for geographic sales analysis.
        expr: DELIVERY_COUNTRY
        data_type: VARCHAR
        sample_values:
          - Denmark
          - France
          - Germany
          - Sweden
          - Netherlands

      - name: MARKET
        synonyms: [market type, domestic or international, market segment, sales market]
        description: Market classification - National (domestic Denmark) or International (exports).
        expr: MARKET
        data_type: VARCHAR
        sample_values:
          - National
          - International

      # === TRANSACTION DIMENSIONS ===
      - name: INVOICE_ID
        synonyms: [invoice number, order number, order id, invoice num, booking number]
        description: Unique invoice identifier. CRITICAL for AOV - use COUNT(DISTINCT invoice_id) to count orders.
        expr: INVOICE_ID
        data_type: NUMBER
        sample_values:
          - '10001'
          - '10002'
          - '10003'

      - name: LINE_ID
        synonyms: [line number, invoice line, line item, line seq]
        description: Line number within an invoice.
        expr: LINE_ID
        data_type: NUMBER
        sample_values:
          - '1'
          - '2'
          - '3'

      - name: INVOICE_CURRENCY
        synonyms: [currency, transaction currency, invoice curr, original currency]
        description: Original invoice currency (DKK, EUR, SEK, NOK). All amounts already converted to DKK.
        expr: INVOICE_CURRENCY
        data_type: VARCHAR
        sample_values:
          - DKK
          - EUR
          - SEK
          - NOK

    time_dimensions:
      - name: SALE_DATE
        synonyms: [date, invoice date, order date, transaction date, booking date, sales date]
        description: Date when invoice was issued. PRIMARY date field for all time-based analysis.
        expr: SALE_DATE
        data_type: DATE
        sample_values:
          - '2025-01-15'
          - '2025-02-20'
          - '2025-03-10'

    facts:
      - name: LINE_REVENUE_DKK
        synonyms: [revenue, sales, total sales, sales amount, net sales, turnover]
        description: Total revenue for this line in DKK including products, freight, and discounts. PRIMARY revenue metric for all reporting.
        expr: LINE_REVENUE_DKK
        data_type: NUMBER
        default_aggregation: sum
        sample_values:
          - '299.00'
          - '747.50'
          - '-50.00'
          - '1250.00'

      - name: LINE_COST_DKK
        synonyms: [cost, cogs, total cost, cost of goods]
        description: Total cost for this line in DKK. Currently set to 0 - will be populated when cost data is loaded.
        expr: LINE_COST_DKK
        data_type: NUMBER
        default_aggregation: sum
        sample_values:
          - '0.00'

      - name: LINE_PROFIT_DKK
        synonyms: [profit, gross profit, margin amount, contribution, earnings]
        description: Gross profit for this line in DKK. Currently equals revenue since cost data is not yet loaded.
        expr: LINE_PROFIT_DKK
        data_type: NUMBER
        default_aggregation: sum
        sample_values:
          - '299.00'
          - '747.50'
          - '1250.00'

      - name: PRODUCT_REVENUE_DKK
        synonyms: [product sales only, merchandise sales, goods revenue, product only revenue]
        description: Revenue from physical products only (excludes freight and discounts). Use LINE_REVENUE_DKK for standard reporting.
        expr: PRODUCT_REVENUE_DKK
        data_type: NUMBER
        default_aggregation: sum
        sample_values:
          - '299.00'
          - '747.50'
          - '0.00'

      - name: QUANTITY_SOLD
        synonyms: [quantity, units sold, volume, units, pieces sold, qty]
        description: Number of units sold on this line.
        expr: QUANTITY_SOLD
        data_type: NUMBER
        default_aggregation: sum
        sample_values:
          - '1'
          - '5'
          - '12'
          - '25'

      - name: UNIT_PRICE_DKK
        synonyms: [unit price, price per unit, selling price, item price, unit selling price]
        description: Selling price per unit in DKK (excluding VAT).
        expr: UNIT_PRICE_DKK
        data_type: NUMBER
        default_aggregation: avg
        sample_values:
          - '299.00'
          - '149.50'
          - '89.00'

      - name: UNIT_COST_DKK
        synonyms: [unit cost, cost per unit, cogs per unit, item cost]
        description: Cost per unit in DKK. Currently 0 - will be populated when cost data is loaded.
        expr: UNIT_COST_DKK
        data_type: NUMBER
        default_aggregation: avg
        sample_values:
          - '0.00'

    metrics:
      - name: TOTAL_REVENUE
        synonyms: [total sales, sum of revenue, total turnover, gross revenue]
        description: Total revenue across all lines.
        expr: SUM(line_revenue_dkk)

      - name: TOTAL_PROFIT
        synonyms: [total gross profit, sum of profit, total earnings]
        description: Total gross profit across all lines. Currently equals revenue since cost data is not yet loaded.
        expr: SUM(line_profit_dkk)

      - name: PROFIT_MARGIN_PCT
        synonyms: [profit margin, margin percentage, gross margin, margin pct]
        description: Profit margin percentage. Currently ~100% since cost data is not yet loaded.
        expr: (SUM(line_profit_dkk) / NULLIF(SUM(line_revenue_dkk), 0)) * 100

      - name: AVERAGE_ORDER_VALUE
        synonyms: [aov, avg order value, average invoice value, average basket, mean order value]
        description: Average order value calculated as total revenue / distinct invoice count.
        expr: SUM(line_revenue_dkk) / NULLIF(COUNT(DISTINCT invoice_id), 0)

      - name: TOTAL_ORDERS
        synonyms: [order count, invoice count, number of orders, total invoices]
        description: Count of distinct invoices/orders.
        expr: COUNT(DISTINCT invoice_id)

      - name: TOTAL_CUSTOMERS
        synonyms: [customer count, unique customers, number of customers, distinct customers]
        description: Count of distinct customers.
        expr: COUNT(DISTINCT customer_id)

      - name: TOTAL_UNITS
        synonyms: [units sold, total quantity, total volume, pieces sold]
        description: Total units/quantity sold.
        expr: SUM(quantity_sold)

      - name: REVENUE_GROWTH_YOY_PCT
        synonyms: [year over year growth, yoy growth, annual growth, yearly growth]
        description: Year-over-year revenue growth percentage. Compares current period to same period last year.
        expr: |
          (SUM(CASE WHEN YEAR(sale_date) = YEAR(CURRENT_DATE()) THEN line_revenue_dkk ELSE 0 END) -
           SUM(CASE WHEN YEAR(sale_date) = YEAR(CURRENT_DATE()) - 1 THEN line_revenue_dkk ELSE 0 END)) /
          NULLIF(SUM(CASE WHEN YEAR(sale_date) = YEAR(CURRENT_DATE()) - 1 THEN line_revenue_dkk ELSE 0 END), 0) * 100

      - name: REVENUE_GROWTH_MOM_PCT
        synonyms: [month over month growth, mom growth, monthly growth]
        description: Month-over-month revenue growth percentage. Compares current month to previous month.
        expr: |
          (SUM(CASE WHEN DATE_TRUNC('MONTH', sale_date) = DATE_TRUNC('MONTH', CURRENT_DATE()) THEN line_revenue_dkk ELSE 0 END) -
           SUM(CASE WHEN DATE_TRUNC('MONTH', sale_date) = DATE_TRUNC('MONTH', DATEADD(MONTH, -1, CURRENT_DATE())) THEN line_revenue_dkk ELSE 0 END)) /
          NULLIF(SUM(CASE WHEN DATE_TRUNC('MONTH', sale_date) = DATE_TRUNC('MONTH', DATEADD(MONTH, -1, CURRENT_DATE())) THEN line_revenue_dkk ELSE 0 END), 0) * 100

    filters:
      - name: MATCHED_PRODUCTS
        synonyms: [prestashop matched, enriched products, matched only, prestashop enriched]
        description: Products matched with PrestaShop catalog (85%+ of recent data).
        expr: prestashop_match_status = 'Matched'

      - name: PRODUCT_SALES_ONLY
        synonyms: [exclude adjustments, products only, no freight, no discounts]
        description: Excludes freight, discounts, and adjustment line items.
        expr: prestashop_match_status = 'Matched'

      - name: CURRENT_YEAR
        synonyms: [this year, year to date, ytd, current fiscal year]
        description: Sales from current calendar year.
        expr: YEAR(sale_date) = YEAR(CURRENT_DATE())

      - name: LAST_YEAR
        synonyms: [previous year, prior year, last fiscal year]
        description: Sales from previous calendar year.
        expr: YEAR(sale_date) = YEAR(CURRENT_DATE()) - 1

      - name: LAST_WEEK
        synonyms: [past week, previous week, past 7 days]
        description: Sales from last 7 days.
        expr: sale_date >= DATEADD(DAY, -7, CURRENT_DATE())

      - name: LAST_MONTH
        synonyms: [past month, previous month, past 30 days, last 30 days]
        description: Sales from last 30 days.
        expr: sale_date >= DATEADD(DAY, -30, CURRENT_DATE())

      - name: LAST_QUARTER
        synonyms: [past quarter, previous quarter, last 90 days, past 90 days]
        description: Sales from last 90 days.
        expr: sale_date >= DATEADD(DAY, -90, CURRENT_DATE())

      - name: B2B_ONLY
        synonyms: [business customers only, wholesale only, b2b segment, business sales]
        description: B2B customer segment only.
        expr: customer_segment = 'B2B'

      - name: B2C_ONLY
        synonyms: [consumer sales only, direct sales only, b2c segment, retail sales]
        description: B2C customer segment only.
        expr: customer_segment = 'B2C'

      - name: THIS_MONTH
        synonyms: [current month, month to date, mtd, this month to date]
        description: Sales from current calendar month to date.
        expr: DATE_TRUNC('MONTH', sale_date) = DATE_TRUNC('MONTH', CURRENT_DATE())

      - name: LAST_MONTH_COMPLETE
        synonyms: [previous month complete, prior month, last full month, previous calendar month]
        description: Sales from previous complete calendar month.
        expr: DATE_TRUNC('MONTH', sale_date) = DATE_TRUNC('MONTH', DATEADD(MONTH, -1, CURRENT_DATE()))

      - name: THIS_QUARTER
        synonyms: [current quarter, quarter to date, qtd, this quarter to date]
        description: Sales from current calendar quarter to date (Q1/Q2/Q3/Q4).
        expr: DATE_TRUNC('QUARTER', sale_date) = DATE_TRUNC('QUARTER', CURRENT_DATE())

      - name: LAST_QUARTER_COMPLETE
        synonyms: [previous quarter complete, prior quarter, last full quarter, previous calendar quarter]
        description: Sales from previous complete calendar quarter.
        expr: DATE_TRUNC('QUARTER', sale_date) = DATE_TRUNC('QUARTER', DATEADD(QUARTER, -1, CURRENT_DATE()))

      - name: TOP_CATEGORIES
        synonyms: [main categories, core products, primary categories, key products]
        description: Focus on main product lines - Harnesses, Leads, and Collars only (excludes Bowls, Bags, Adjustments, Uncategorized).
        expr: category IN ('Harnesses', 'Leads', 'Collars')

      - name: SCANDINAVIA
        synonyms: [nordic countries, scandinavian countries, nordic region, scandinavia region]
        description: Sales to Scandinavian countries - Denmark, Norway, and Sweden.
        expr: delivery_country IN ('Denmark', 'Norway', 'Sweden')

      - name: DACH_REGION
        synonyms: [dach, german speaking countries, dach countries]
        description: Sales to DACH region - Germany, Austria, and Switzerland.
        expr: delivery_country IN ('Germany', 'Austria', 'Switzerland')

      - name: WESTERN_EUROPE
        synonyms: [western europe region, west europe, western european countries]
        description: Sales to Western European countries - France, Netherlands, Belgium, and Luxembourg.
        expr: delivery_country IN ('France', 'United Kingdom', 'Netherlands', 'Belgium', 'Luxembourg')

  - name: VW_CUSTOMER_MASTER
    description: Customer master data - one row per customer. Use for customer information and segmentation.
    base_table:
      database: ECONOMIC
      schema: SILVER
      table: VW_CUSTOMER_MASTER

    dimensions:
      - name: CUSTOMER_ID
        synonyms: [customer number, client id, account id, cust id]
        description: Unique customer identifier.
        expr: CUSTOMER_ID
        data_type: NUMBER
        unique: true
        sample_values:
          - '1001'
          - '2045'
          - '3089'

      - name: CUSTOMER_NAME
        synonyms: [customer, client name, account name, company name]
        description: Full customer name.
        expr: CUSTOMER_NAME
        data_type: VARCHAR
        sample_values:
          - Pet Shop Denmark
          - Dog Boutique Paris
          - Hundebutikk Norge

      - name: CUSTOMER_SEGMENT
        synonyms: [customer type, segment, business type]
        description: Customer segment - B2B or B2C.
        expr: CUSTOMER_SEGMENT
        data_type: VARCHAR
        sample_values:
          - B2B
          - B2C

      - name: CUSTOMER_COUNTRY
        synonyms: [country, nation, registered country]
        description: Country where customer is registered.
        expr: CUSTOMER_COUNTRY
        data_type: VARCHAR
        sample_values:
          - Denmark
          - France
          - Germany
          - Sweden

      - name: CUSTOMER_CITY
        synonyms: [city, location, town]
        description: Customer city location.
        expr: CUSTOMER_CITY
        data_type: VARCHAR
        sample_values:
          - Copenhagen
          - Paris
          - Amsterdam

      - name: EMAIL_ADDRESS
        synonyms: [email, contact email, customer email]
        description: Customer email address.
        expr: EMAIL_ADDRESS
        data_type: VARCHAR
        sample_values:
          - contact@petshop.dk
          - info@dogboutique.fr

      - name: PREFERRED_CURRENCY
        synonyms: [currency, default currency]
        description: Customer preferred transaction currency.
        expr: PREFERRED_CURRENCY
        data_type: VARCHAR
        sample_values:
          - DKK
          - EUR
          - SEK

    primary_key:
      columns:
        - CUSTOMER_ID

  - name: VW_PRODUCT_MASTER
    description: Product master data from PrestaShop - one row per SKU/variant. Includes category, size, color, EAN13. Use for product catalog lookups and active product analysis.
    base_table:
      database: ECONOMIC
      schema: SILVER
      table: VW_PRODUCT_MASTER

    dimensions:
      - name: PRODUCT_SKU
        synonyms: [sku, product code, item number, article number]
        description: Unique product identifier (Stock Keeping Unit).
        expr: PRODUCT_SKU
        data_type: VARCHAR
        unique: true
        sample_values:
          - HAR0569
          - LEA0335
          - COL0311

      - name: PRODUCT_NAME
        synonyms: [item name, product description, product title]
        description: Full product name from PrestaShop.
        expr: PRODUCT_NAME
        data_type: VARCHAR
        sample_values:
          - Comfort Walk Air™ Harness
          - Urban Trail™ Leash
          - Urban Explorer™ Collar

      - name: CATEGORY_NAME
        synonyms: [category, product category, product group]
        description: PrestaShop product category.
        expr: CATEGORY_NAME
        data_type: VARCHAR
        sample_values:
          - Harnesses
          - Leads
          - Collars
          - Bowls

      - name: SIZE
        synonyms: [product size, size variant, size option]
        description: Product size.
        expr: SIZE
        data_type: VARCHAR
        sample_values:
          - XS
          - S
          - M
          - L
          - XL

      - name: COLOR
        synonyms: [product color, color variant, colour]
        description: Product color.
        expr: COLOR
        data_type: VARCHAR
        sample_values:
          - Black
          - Mocca
          - Ocean Blue
          - Orange Sun

      - name: EAN13
        synonyms: [barcode, ean, gtin]
        description: EAN13 barcode for product identification.
        expr: EAN13
        data_type: VARCHAR
        sample_values:
          - '5710534200001'
          - '5710534200018'

      - name: IS_ACTIVE
        synonyms: [active, product active, is available]
        description: Whether product is currently active in PrestaShop.
        expr: IS_ACTIVE
        data_type: BOOLEAN
        sample_values:
          - 'true'
          - 'false'

      - name: VARIANT_ID
        synonyms: [combination id, prestashop variant id]
        description: PrestaShop variant ID (unique size/color combination).
        expr: VARIANT_ID
        data_type: NUMBER
        sample_values:
          - '949'
          - '950'
          - '1021'

    time_dimensions:
      - name: LAST_UPDATED_DATE
        synonyms: [last modified, updated date, last update]
        description: Date when product was last updated in PrestaShop.
        expr: LAST_UPDATED_DATE
        data_type: TIMESTAMP_LTZ
        sample_values:
          - '2024-11-05'
          - '2025-01-15'

    facts:
      - name: PRICE_IMPACT
        synonyms: [variant price adjustment, price modifier]
        description: Price adjustment for this variant vs base product price.
        expr: PRICE_IMPACT
        data_type: NUMBER
        default_aggregation: avg
        sample_values:
          - '0.00'
          - '25.00'
          - '-10.00'

    filters:
      - name: ACTIVE_PRODUCTS
        synonyms: [active only, available products, current products]
        description: Only currently active products.
        expr: is_active = true

    primary_key:
      columns:
        - PRODUCT_SKU

relationships:
  - name: SALES_TO_CUSTOMER
    left_table: VW_SALES_DETAIL
    right_table: VW_CUSTOMER_MASTER
    relationship_columns:
      - left_column: CUSTOMER_ID
        right_column: CUSTOMER_ID
    relationship_type: many_to_one

  - name: SALES_TO_PRODUCT
    left_table: VW_SALES_DETAIL
    right_table: VW_PRODUCT_MASTER
    relationship_columns:
      - left_column: PRODUCT_SKU
        right_column: PRODUCT_SKU
    relationship_type: many_to_one

verified_queries:
  - name: last_week_revenue
    question: What were our total sales last week?
    sql: |
      SELECT SUM(line_revenue_dkk) AS total_revenue_dkk, COUNT(DISTINCT invoice_id) AS orders
      FROM VW_SALES_DETAIL
      WHERE sale_date >= DATEADD(DAY, -7, CURRENT_DATE())
    verified_by: System
    verified_at: 1730325600
    use_as_onboarding_question: true

  - name: last_month_by_category
    question: Show me revenue by category for the last month
    sql: |
      SELECT category, SUM(line_revenue_dkk) AS revenue, SUM(quantity_sold) AS units, COUNT(DISTINCT invoice_id) AS orders
      FROM VW_SALES_DETAIL
      WHERE sale_date >= DATEADD(DAY, -30, CURRENT_DATE())
        AND prestashop_match_status = 'Matched'
      GROUP BY category
      ORDER BY revenue DESC
    verified_by: System
    verified_at: 1730937600
    use_as_onboarding_question: true

  - name: b2b_vs_b2c_last_quarter
    question: Compare B2B versus B2C sales for the last quarter
    sql: |
      SELECT customer_segment, COUNT(DISTINCT customer_id) AS customers, SUM(line_revenue_dkk) AS revenue,
        COUNT(DISTINCT invoice_id) AS orders, SUM(line_revenue_dkk) / NULLIF(COUNT(DISTINCT invoice_id), 0) AS aov
      FROM VW_SALES_DETAIL
      WHERE sale_date >= DATEADD(DAY, -90, CURRENT_DATE())
      GROUP BY customer_segment
      ORDER BY revenue DESC
    verified_by: System
    verified_at: 1730325600
    use_as_onboarding_question: true

  - name: top_products_this_month
    question: Show me the top 10 products by revenue this month
    sql: |
      SELECT product_sku, product_name, category, size, color, SUM(quantity_sold) AS units, SUM(line_revenue_dkk) AS revenue
      FROM VW_SALES_DETAIL
      WHERE sale_date >= DATE_TRUNC('MONTH', CURRENT_DATE())
        AND prestashop_match_status = 'Matched'
      GROUP BY product_sku, product_name, category, size, color
      ORDER BY revenue DESC
      LIMIT 10
    verified_by: System
    verified_at: 1730937600
    use_as_onboarding_question: true

  - name: monthly_trend_2025
    question: Show monthly sales trend for 2025
    sql: |
      SELECT DATE_TRUNC('MONTH', sale_date) AS month, SUM(line_revenue_dkk) AS revenue,
        COUNT(DISTINCT invoice_id) AS orders, SUM(line_revenue_dkk) / NULLIF(COUNT(DISTINCT invoice_id), 0) AS aov
      FROM VW_SALES_DETAIL
      WHERE YEAR(sale_date) = 2025
      GROUP BY DATE_TRUNC('MONTH', sale_date)
      ORDER BY month
    verified_by: System
    verified_at: 1730325600

  - name: sales_by_country_last_month
    question: What were sales by delivery country in the last month?
    sql: |
      SELECT delivery_country, SUM(line_revenue_dkk) AS revenue, COUNT(DISTINCT invoice_id) AS orders
      FROM VW_SALES_DETAIL
      WHERE sale_date >= DATEADD(DAY, -30, CURRENT_DATE())
      GROUP BY delivery_country
      ORDER BY revenue DESC
    verified_by: System
    verified_at: 1730325600

  - name: size_color_performance_ytd
    question: Show top size and color combinations by revenue this year
    sql: |
      SELECT size, color, SUM(quantity_sold) AS units, SUM(line_revenue_dkk) AS revenue
      FROM VW_SALES_DETAIL
      WHERE YEAR(sale_date) = YEAR(CURRENT_DATE())
        AND prestashop_match_status = 'Matched'
      GROUP BY size, color
      ORDER BY revenue DESC
      LIMIT 20
    verified_by: System
    verified_at: 1730937600

  - name: week_over_week_comparison
    question: Compare this week versus last week sales
    sql: |
      SELECT
        CASE WHEN sale_date >= DATEADD(DAY, -7, CURRENT_DATE()) THEN 'This Week'
             WHEN sale_date >= DATEADD(DAY, -14, CURRENT_DATE()) THEN 'Last Week'
        END AS period,
        SUM(line_revenue_dkk) AS revenue,
        COUNT(DISTINCT invoice_id) AS orders,
        SUM(quantity_sold) AS units
      FROM VW_SALES_DETAIL
      WHERE sale_date >= DATEADD(DAY, -14, CURRENT_DATE())
      GROUP BY period
      ORDER BY period DESC
    verified_by: System
    verified_at: 1730937600
    use_as_onboarding_question: true

  - name: top_customers_last_quarter
    question: Show me top 10 customers by revenue in the last quarter
    sql: |
      SELECT customer_name, customer_segment, delivery_country,
        SUM(line_revenue_dkk) AS revenue, COUNT(DISTINCT invoice_id) AS orders
      FROM VW_SALES_DETAIL
      WHERE sale_date >= DATEADD(DAY, -90, CURRENT_DATE())
      GROUP BY customer_name, customer_segment, delivery_country
      ORDER BY revenue DESC
      LIMIT 10
    verified_by: System
    verified_at: 1730937600

  - name: category_by_segment_this_year
    question: Compare category performance between B2B and B2C this year
    sql: |
      SELECT customer_segment, category, SUM(quantity_sold) AS units, SUM(line_revenue_dkk) AS revenue
      FROM VW_SALES_DETAIL
      WHERE YEAR(sale_date) = YEAR(CURRENT_DATE())
        AND prestashop_match_status = 'Matched'
      GROUP BY customer_segment, category
      ORDER BY customer_segment, revenue DESC
    verified_by: System
    verified_at: 1730937600

  - name: yoy_revenue_growth_by_category
    question: Show year over year revenue growth by category
    sql: |
      SELECT category,
        SUM(CASE WHEN YEAR(sale_date) = YEAR(CURRENT_DATE()) THEN line_revenue_dkk ELSE 0 END) AS current_year_revenue,
        SUM(CASE WHEN YEAR(sale_date) = YEAR(CURRENT_DATE()) - 1 THEN line_revenue_dkk ELSE 0 END) AS last_year_revenue,
        (SUM(CASE WHEN YEAR(sale_date) = YEAR(CURRENT_DATE()) THEN line_revenue_dkk ELSE 0 END) -
         SUM(CASE WHEN YEAR(sale_date) = YEAR(CURRENT_DATE()) - 1 THEN line_revenue_dkk ELSE 0 END)) /
        NULLIF(SUM(CASE WHEN YEAR(sale_date) = YEAR(CURRENT_DATE()) - 1 THEN line_revenue_dkk ELSE 0 END), 0) * 100 AS growth_pct
      FROM VW_SALES_DETAIL
      WHERE prestashop_match_status = 'Matched'
        AND YEAR(sale_date) IN (YEAR(CURRENT_DATE()), YEAR(CURRENT_DATE()) - 1)
      GROUP BY category
      ORDER BY current_year_revenue DESC
    verified_by: System
    verified_at: 1730937600
